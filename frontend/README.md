# Getting Started with the Bitloops Todo App

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

You should not need to run it directly from this folder as it is part of the docker build file but if you want to run it locally for development you can follow the instructions below at "Available Scripts".

## Web App Design

The web app is using a flavour of the MVVM (Model-View-View Model) pattern. You should be aware of the following ideas:

### Components

Here we have simple React code combined with imports of CSS files for the formatting. These components do not have state and you could inject anything you like through the props to test them.

### Controllers

A controller wraps a Component and maps the functions and values coming from a View Model (see below). You might have the occasional useState for maybe an [open, setOpen] value but nothing more.

### State

For state Recoil is being used but the state interacts with the ViewModel and should not be directly accessed or mutated from the Controllers with the exception of the App.tsx file that sets the setters and getters in the View Models.

### View Models

A View Model is a class that has a clearly defined interface that provides controllers with all the necessary functions and values to feed to their Components. We are utilizing the concept of CQRS meaning that we have separate functions that cause side-effects (aka mutations) and separate values that work like queries.

### Repositories

Repositories are used to interact with the app state (e.g. localStorage) and the Services (see below). For example, a service expects some authentication metadata (JWT) with the requests and instead of complicating the ViewModel with these details, a Repository provides a cleaner interface to the ViewModel for using the Services by taking care of the JWT injection etc. You can also use Repositories to deal with local caching etc.

### Services

Services are the gRPC endpoints that are automatically generated by the protobuf file and you could also add other services to wrap 3rd party API calls (e.g. Google Maps API).

## Technologies Used

To communicate with the backend, grpc-web is being used for the main functionality while a couple REST requests are used for registration and login.

To receive realtime notifications from the backend, SSE (Server Sent Events) are being used.

The gRPC implementation requires the JWT token to be sent in the authorization headers and it is possible to sent a cache-hash for the backend to check if a get request has the same or new data. If the server sees that the data it is about to send have the same cache-hash then an exception is thrown which is handled on the frontend and does nothing if thrown as it knows that the data already in its local store is up to date. This saves data usage.

The grpc-web SSE implementation has significant limitation for long running connections and it cannot track if a client has disconnected or not. For this reason, the client sends a ping about every minute to notify the backend that the connection is alive. If the ping is not sent, the backend assumes the frontend has disconnected and clears the subscriptions to save resources. In the near future, we will release [Bitloops Ermis](https://bitloops.com/ermis) which will a) allow for scaling of the gateway to multiple instances and b) is connection aware and doesn't require explicit pings.

## Launch the app using the Dockerfile

To build the image:

```bash
docker build -t todo-frontend .
```

To run the container:

```bash
docker run -dp 3000:3000 todo-frontend
```

## Available Scripts

In the project directory, you can run:

### `yarn` or `npm i`

Installs all the dependencies. This is needed before you run the start script.

### `yarn start` or `npm start`

Runs the app in the development mode.\
Open [http://localhost:3000](http://localhost:3000) to view it in the browser.

The page will reload if you make edits.\
You will also see any lint errors in the console.

### `yarn build` or `npm run build`

Builds the app for production to the `build` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

See the section about [deployment](https://facebook.github.io/create-react-app/docs/deployment) for more information.

### `yarn proto` or `npm run proto`

Regenerates the TodoServiceClientPb.ts and todo_pb.js and todo_pb.d.ts files based on the todo.proto file.
