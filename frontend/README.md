# Getting Started with the Bitloops Todo App

<img width="488" alt="image" src="https://github.com/bitloops/ddd-hexagonal-cqrs-es-eda/assets/1571105/4570473b-4e67-4050-9935-967acfe0b7c6">

This project was bootstrapped with [Vite](https://vite.dev/).

You should not need to run it directly from this folder as it is part of the docker build file but if you want to run it locally for development you can follow the instructions below at "Available Scripts".

## Web App Design

The web app is using a flavour of the MVVM (Model-View-View Model) pattern. You should be aware of the following ideas:

### Components

Here we have simple React code combined with imports of CSS files for the formatting. These components do not have state and you could inject anything you like through the props to test them.

### Controllers

A controller wraps a Component and maps the functions and values coming from a View Model (see below). You might have the occasional useState for maybe an [open, setOpen] value but nothing more.

### State

For state Recoil is being used but the state interacts with the ViewModel and should not be directly accessed or mutated from the Controllers with the exception of the App.tsx file that sets the setters and getters in the View Models.

### View Models

A View Model is a class that has a clearly defined interface that provides controllers with all the necessary functions and values to feed to their Components. We are utilizing the concept of CQRS meaning that we have separate functions that cause side-effects (aka mutations) and separate values that work like queries.

### Repositories

Repositories are used to interact with the app state (e.g. localStorage) and the Services (see below). For example, a service expects some authentication metadata (JWT) with the requests and instead of complicating the ViewModel with these details, a Repository provides a cleaner interface to the ViewModel for using the Services by taking care of the JWT injection etc. You can also use Repositories to deal with local caching etc.

### Services

Services are the gRPC endpoints that are automatically generated by the protobuf file and you could also add other services to wrap 3rd party API calls (e.g. Google Maps API).

## Technologies Used

To communicate with the backend, REST requests are being used for the main functionality while a couple REST requests are used for registration and login. For the automatic generation of client code, `@hey-api/openapi-ts` is being used and after changes in the backend occur you can run `npm run openapi-ts` to generate the new client code.

To receive realtime notifications from the backend, SSE (Server Sent Events) are being used.

The grpc-web SSE implementation has significant limitation for long running connections and it cannot track if a client has disconnected or not. For this reason, the client sends a ping about every minute to notify the backend that the connection is alive. If the ping is not sent, the backend assumes the frontend has disconnected and clears the subscriptions to save resources. In the future, we will release [Bitloops Ermis](https://bitloops.com/ermis) which will a) allow for scaling of the gateway to multiple instances and b) is connection aware and doesn't require explicit pings.

## Launch the app using the Dockerfile

To build the image:

```bash
docker build -t todo-frontend .
```

To run the container:

```bash
docker run -dp 4173:4173 todo-frontend
```

## Available Scripts

In the project directory, you can run:

### `npm i` or `npm install`

Installs all the dependencies. This is needed before you run the start script.

### `npm run dev`

Runs the app in the development mode.\
Open [http://localhost:5175](http://localhost:5175) to view it in the browser.

The page will reload if you make edits.\
You will also see any lint errors in the console.

### `npm run build`

Builds the app for production to the `dist` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

To preview the production build, run:

```bash
npm run preview
```

### `npm run openapi-ts`

Regenerates the `api` folder files based on Swagger and Open API definitions coming from the backend.

# React + TypeScript + Vite + Recoil

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default tseslint.config([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      ...tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      ...tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      ...tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default tseslint.config([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
